{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _assertThisInitialized from\"@babel/runtime/helpers/assertThisInitialized\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}import*as React from'react';var NavigationEventManager=function(_React$Component){_inherits(NavigationEventManager,_React$Component);var _super=_createSuper(NavigationEventManager);function NavigationEventManager(){var _this;_classCallCheck(this,NavigationEventManager);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_defineProperty(_assertThisInitialized(_this),\"_actionSubscription\",void 0);_defineProperty(_assertThisInitialized(_this),\"_willFocusSubscription\",void 0);_defineProperty(_assertThisInitialized(_this),\"_willBlurSubscription\",void 0);_defineProperty(_assertThisInitialized(_this),\"_didFocusSubscription\",void 0);_defineProperty(_assertThisInitialized(_this),\"_didBlurSubscription\",void 0);_defineProperty(_assertThisInitialized(_this),\"_refocusSubscription\",void 0);_defineProperty(_assertThisInitialized(_this),\"_lastWillBlurKey\",void 0);_defineProperty(_assertThisInitialized(_this),\"_lastWillFocusKey\",void 0);_defineProperty(_assertThisInitialized(_this),\"_lastDidBlurKey\",void 0);_defineProperty(_assertThisInitialized(_this),\"_lastDidFocusKey\",void 0);_defineProperty(_assertThisInitialized(_this),\"_handleAction\",function(_ref){var state=_ref.state,lastState=_ref.lastState,action=_ref.action,type=_ref.type,context=_ref.context;var _lastState$routes;var _this$props=_this.props,navigation=_this$props.navigation,onEvent=_this$props.onEvent;if(!navigation.isFocused()){return;}var previous=lastState?(_lastState$routes=lastState.routes)===null||_lastState$routes===void 0?void 0:_lastState$routes[lastState.index]:undefined;var current=state.routes[state.index];var payload={context:\"\".concat(current.key,\":\").concat(action.type,\"_\").concat(context||'Root'),state:current,lastState:previous,action:action,type:type};if((previous===null||previous===void 0?void 0:previous.key)!==current.key){_this._emitWillFocus(current.key,payload);if(previous===null||previous===void 0?void 0:previous.key){_this._emitWillBlur(previous.key,payload);}}if((lastState===null||lastState===void 0?void 0:lastState.isTransitioning)!==state.isTransitioning&&state.isTransitioning===false){if(_this._lastWillBlurKey){_this._emitDidBlur(_this._lastWillBlurKey,payload);}if(_this._lastWillFocusKey){_this._emitDidFocus(_this._lastWillFocusKey,payload);}}onEvent(current.key,'action',payload);});_defineProperty(_assertThisInitialized(_this),\"_handleWillFocus\",function(_ref2){var lastState=_ref2.lastState,action=_ref2.action,context=_ref2.context,type=_ref2.type;var _lastState$routes2;var navigation=_this.props.navigation;var route=navigation.state.routes[navigation.state.index];_this._emitWillFocus(route.key,{context:\"\".concat(route.key,\":\").concat(action.type,\"_\").concat(context||'Root'),state:route,lastState:lastState===null||lastState===void 0?void 0:(_lastState$routes2=lastState.routes)===null||_lastState$routes2===void 0?void 0:_lastState$routes2.find(function(r){return r.key===route.key;}),action:action,type:type});});_defineProperty(_assertThisInitialized(_this),\"_handleWillBlur\",function(_ref3){var lastState=_ref3.lastState,action=_ref3.action,context=_ref3.context,type=_ref3.type;var _lastState$routes3;var navigation=_this.props.navigation;var route=navigation.state.routes[navigation.state.index];_this._emitWillBlur(route.key,{context:\"\".concat(route.key,\":\").concat(action.type,\"_\").concat(context||'Root'),state:route,lastState:lastState===null||lastState===void 0?void 0:(_lastState$routes3=lastState.routes)===null||_lastState$routes3===void 0?void 0:_lastState$routes3.find(function(r){return r.key===route.key;}),action:action,type:type});});_defineProperty(_assertThisInitialized(_this),\"_handleDidFocus\",function(_ref4){var lastState=_ref4.lastState,action=_ref4.action,context=_ref4.context,type=_ref4.type;var navigation=_this.props.navigation;if(_this._lastWillFocusKey){var route=navigation.state.routes.find(function(r){return r.key===_this._lastWillFocusKey;});if(route){var _lastState$routes4;_this._emitDidFocus(route.key,{context:\"\".concat(route.key,\":\").concat(action.type,\"_\").concat(context||'Root'),state:route,lastState:lastState===null||lastState===void 0?void 0:(_lastState$routes4=lastState.routes)===null||_lastState$routes4===void 0?void 0:_lastState$routes4.find(function(r){return r.key===route.key;}),action:action,type:type});}}});_defineProperty(_assertThisInitialized(_this),\"_handleDidBlur\",function(_ref5){var lastState=_ref5.lastState,action=_ref5.action,context=_ref5.context,type=_ref5.type;var navigation=_this.props.navigation;if(_this._lastWillBlurKey){var route=navigation.state.routes.find(function(r){return r.key===_this._lastWillBlurKey;});if(route){var _lastState$routes5;_this._emitDidBlur(route.key,{context:\"\".concat(route.key,\":\").concat(action.type,\"_\").concat(context||'Root'),state:route,lastState:lastState===null||lastState===void 0?void 0:(_lastState$routes5=lastState.routes)===null||_lastState$routes5===void 0?void 0:_lastState$routes5.find(function(r){return r.key===route.key;}),action:action,type:type});}}});_defineProperty(_assertThisInitialized(_this),\"_handleRefocus\",function(){var _this$props2=_this.props,onEvent=_this$props2.onEvent,navigation=_this$props2.navigation;var route=navigation.state.routes[navigation.state.index];onEvent(route.key,'refocus');});_defineProperty(_assertThisInitialized(_this),\"_emitWillFocus\",function(target,payload){if(_this._lastWillBlurKey===target){_this._lastWillBlurKey=undefined;}if(_this._lastWillFocusKey===target){return;}_this._lastDidFocusKey=undefined;_this._lastWillFocusKey=target;var _this$props3=_this.props,navigation=_this$props3.navigation,onEvent=_this$props3.onEvent;onEvent(target,'willFocus',payload);if(typeof navigation.state.isTransitioning!=='boolean'||navigation.state.isTransitioning!==true&&!navigation.dangerouslyGetParent()){_this._emitDidFocus(target,payload);}});_defineProperty(_assertThisInitialized(_this),\"_emitWillBlur\",function(target,payload){if(_this._lastWillFocusKey===target){_this._lastWillFocusKey=undefined;}if(_this._lastWillBlurKey===target){return;}_this._lastDidBlurKey=undefined;_this._lastWillBlurKey=target;var _this$props4=_this.props,navigation=_this$props4.navigation,onEvent=_this$props4.onEvent;onEvent(target,'willBlur',payload);if(typeof navigation.state.isTransitioning!=='boolean'||navigation.state.isTransitioning!==true&&!navigation.dangerouslyGetParent()){_this._emitDidBlur(target,payload);}});_defineProperty(_assertThisInitialized(_this),\"_emitDidFocus\",function(target,payload){if(_this._lastWillFocusKey!==target||_this._lastDidFocusKey===target){return;}_this._lastDidFocusKey=target;var onEvent=_this.props.onEvent;onEvent(target,'didFocus',payload);});_defineProperty(_assertThisInitialized(_this),\"_emitDidBlur\",function(target,payload){if(_this._lastWillBlurKey!==target||_this._lastDidBlurKey===target){return;}_this._lastDidBlurKey=target;var onEvent=_this.props.onEvent;onEvent(target,'didBlur',payload);});return _this;}_createClass(NavigationEventManager,[{key:\"componentDidMount\",value:function componentDidMount(){var navigation=this.props.navigation;this._actionSubscription=navigation.addListener('action',this._handleAction);this._willFocusSubscription=navigation.addListener('willFocus',this._handleWillFocus);this._willBlurSubscription=navigation.addListener('willBlur',this._handleWillBlur);this._didFocusSubscription=navigation.addListener('didFocus',this._handleDidFocus);this._didBlurSubscription=navigation.addListener('didBlur',this._handleDidBlur);this._refocusSubscription=navigation.addListener('refocus',this._handleRefocus);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){var _this$_actionSubscrip,_this$_willFocusSubsc,_this$_willBlurSubscr,_this$_didFocusSubscr,_this$_didBlurSubscri,_this$_refocusSubscri;(_this$_actionSubscrip=this._actionSubscription)===null||_this$_actionSubscrip===void 0?void 0:_this$_actionSubscrip.remove();(_this$_willFocusSubsc=this._willFocusSubscription)===null||_this$_willFocusSubsc===void 0?void 0:_this$_willFocusSubsc.remove();(_this$_willBlurSubscr=this._willBlurSubscription)===null||_this$_willBlurSubscr===void 0?void 0:_this$_willBlurSubscr.remove();(_this$_didFocusSubscr=this._didFocusSubscription)===null||_this$_didFocusSubscr===void 0?void 0:_this$_didFocusSubscr.remove();(_this$_didBlurSubscri=this._didBlurSubscription)===null||_this$_didBlurSubscri===void 0?void 0:_this$_didBlurSubscri.remove();(_this$_refocusSubscri=this._refocusSubscription)===null||_this$_refocusSubscri===void 0?void 0:_this$_refocusSubscri.remove();}},{key:\"render\",value:function render(){return null;}}]);return NavigationEventManager;}(React.Component);export{NavigationEventManager as default};","map":{"version":3,"sources":["NavigationFocusEvents.js"],"names":["React","componentDidMount","navigation","componentWillUnmount","context","onEvent","previous","lastState","current","state","payload","action","type","route","r","render"],"mappings":"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","sourcesContent":["// @ts-check\n\nimport * as React from 'react';\n\n/**\n * @typedef {object} State\n * @prop {number} index\n * @prop {({ key: string } & (State | {}))[]} routes\n * @prop {boolean} [isTransitioning]\n *\n * @typedef {object} ParentPayload\n * @prop {string} type\n * @prop {object} action\n * @prop {State} state\n * @prop {State | {key: string, routes?: undefined, index?: undefined, isTransitioning?: undefined} | undefined | null} lastState\n * @prop {string} [context]\n *\n * @typedef {object} Payload\n * @prop {string} type\n * @prop {object} action\n * @prop {State | {key: string}} state\n * @prop {State | {key: string} | undefined | null} lastState\n * @prop {string} [context]\n *\n * @typedef {object} Props\n * @prop {object} navigation\n * @prop {Function} navigation.addListener\n * @prop {Function} navigation.removeListener\n * @prop {() => boolean} navigation.isFocused\n * @prop {() => object | undefined} navigation.dangerouslyGetParent\n * @prop {State} navigation.state\n * @prop {(target: string, type: string, data: any) => void} onEvent\n *\n * @extends {React.Component<Props>}\n */\nexport default class NavigationEventManager extends React.Component {\n  componentDidMount() {\n    const { navigation } = this.props;\n\n    this._actionSubscription = navigation.addListener(\n      'action',\n      this._handleAction\n    );\n\n    this._willFocusSubscription = navigation.addListener(\n      'willFocus',\n      this._handleWillFocus\n    );\n\n    this._willBlurSubscription = navigation.addListener(\n      'willBlur',\n      this._handleWillBlur\n    );\n\n    this._didFocusSubscription = navigation.addListener(\n      'didFocus',\n      this._handleDidFocus\n    );\n\n    this._didBlurSubscription = navigation.addListener(\n      'didBlur',\n      this._handleDidBlur\n    );\n\n    this._refocusSubscription = navigation.addListener(\n      'refocus',\n      this._handleRefocus\n    );\n  }\n\n  componentWillUnmount() {\n    this._actionSubscription?.remove();\n    this._willFocusSubscription?.remove();\n    this._willBlurSubscription?.remove();\n    this._didFocusSubscription?.remove();\n    this._didBlurSubscription?.remove();\n    this._refocusSubscription?.remove();\n  }\n\n  /**\n   * @type {{ remove(): void } | undefined}\n   */\n  _actionSubscription;\n\n  /**\n   * @type {{ remove(): void } | undefined}\n   */\n  _willFocusSubscription;\n\n  /**\n   * @type {{ remove(): void } | undefined}\n   */\n  _willBlurSubscription;\n\n  /**\n   * @type {{ remove(): void } | undefined}\n   */\n  _didFocusSubscription;\n\n  /**\n   * @type {{ remove(): void } | undefined}\n   */\n  _didBlurSubscription;\n\n  /**\n   * @type {{ remove(): void } | undefined}\n   */\n  _refocusSubscription;\n\n  /**\n   * @type {string | undefined}\n   */\n  _lastWillBlurKey;\n\n  /**\n   * @type {string | undefined}\n   */\n  _lastWillFocusKey;\n\n  /**\n   * @type {string | undefined}\n   */\n  _lastDidBlurKey;\n\n  /**\n   * @type {string | undefined}\n   */\n  _lastDidFocusKey;\n\n  /**\n   * The 'action' event will fire when navigation state changes.\n   * Detect if the focused route changed here and emit appropriate events.\n   *\n   * @param {ParentPayload} payload\n   */\n  _handleAction = ({ state, lastState, action, type, context }) => {\n    const { navigation, onEvent } = this.props;\n\n    // We should only emit events when the navigator is focused\n    // When navigator is not focused, screens inside shouldn't receive focused status either\n    if (!navigation.isFocused()) {\n      return;\n    }\n\n    const previous = lastState\n      ? lastState.routes?.[lastState.index]\n      : undefined;\n    const current = state.routes[state.index];\n\n    const payload = {\n      context: `${current.key}:${action.type}_${context || 'Root'}`,\n      state: current,\n      lastState: previous,\n      action,\n      type,\n    };\n\n    if (previous?.key !== current.key) {\n      this._emitWillFocus(current.key, payload);\n\n      if (previous?.key) {\n        this._emitWillBlur(previous.key, payload);\n      }\n    }\n\n    if (\n      lastState?.isTransitioning !== state.isTransitioning &&\n      state.isTransitioning === false\n    ) {\n      if (this._lastWillBlurKey) {\n        this._emitDidBlur(this._lastWillBlurKey, payload);\n      }\n\n      if (this._lastWillFocusKey) {\n        this._emitDidFocus(this._lastWillFocusKey, payload);\n      }\n    }\n\n    onEvent(current.key, 'action', payload);\n  };\n\n  /**\n   * @param {ParentPayload} payload\n   */\n  _handleWillFocus = ({ lastState, action, context, type }) => {\n    const { navigation } = this.props;\n    const route = navigation.state.routes[navigation.state.index];\n\n    this._emitWillFocus(route.key, {\n      context: `${route.key}:${action.type}_${context || 'Root'}`,\n      state: route,\n      lastState: lastState?.routes?.find((r) => r.key === route.key),\n      action,\n      type,\n    });\n  };\n\n  /**\n   * @param {ParentPayload} payload\n   */\n  _handleWillBlur = ({ lastState, action, context, type }) => {\n    const { navigation } = this.props;\n    const route = navigation.state.routes[navigation.state.index];\n\n    this._emitWillBlur(route.key, {\n      context: `${route.key}:${action.type}_${context || 'Root'}`,\n      state: route,\n      lastState: lastState?.routes?.find((r) => r.key === route.key),\n      action,\n      type,\n    });\n  };\n\n  /**\n   * @param {ParentPayload} payload\n   */\n  _handleDidFocus = ({ lastState, action, context, type }) => {\n    const { navigation } = this.props;\n\n    if (this._lastWillFocusKey) {\n      const route = navigation.state.routes.find(\n        (r) => r.key === this._lastWillFocusKey\n      );\n\n      if (route) {\n        this._emitDidFocus(route.key, {\n          context: `${route.key}:${action.type}_${context || 'Root'}`,\n          state: route,\n          lastState: lastState?.routes?.find((r) => r.key === route.key),\n          action,\n          type,\n        });\n      }\n    }\n  };\n\n  /**\n   * @param {ParentPayload} payload\n   */\n  _handleDidBlur = ({ lastState, action, context, type }) => {\n    const { navigation } = this.props;\n\n    if (this._lastWillBlurKey) {\n      const route = navigation.state.routes.find(\n        (r) => r.key === this._lastWillBlurKey\n      );\n\n      if (route) {\n        this._emitDidBlur(route.key, {\n          context: `${route.key}:${action.type}_${context || 'Root'}`,\n          state: route,\n          lastState: lastState?.routes?.find((r) => r.key === route.key),\n          action,\n          type,\n        });\n      }\n    }\n  };\n\n  _handleRefocus = () => {\n    const { onEvent, navigation } = this.props;\n    const route = navigation.state.routes[navigation.state.index];\n\n    onEvent(route.key, 'refocus');\n  };\n\n  /**\n   * @param {string} target\n   * @param {Payload} payload\n   */\n  _emitWillFocus = (target, payload) => {\n    if (this._lastWillBlurKey === target) {\n      this._lastWillBlurKey = undefined;\n    }\n\n    if (this._lastWillFocusKey === target) {\n      return;\n    }\n\n    this._lastDidFocusKey = undefined;\n    this._lastWillFocusKey = target;\n\n    const { navigation, onEvent } = this.props;\n\n    onEvent(target, 'willFocus', payload);\n\n    if (\n      typeof navigation.state.isTransitioning !== 'boolean' ||\n      (navigation.state.isTransitioning !== true &&\n        !navigation.dangerouslyGetParent())\n    ) {\n      this._emitDidFocus(target, payload);\n    }\n  };\n\n  /**\n   * @param {string} target\n   * @param {Payload} payload\n   */\n  _emitWillBlur = (target, payload) => {\n    if (this._lastWillFocusKey === target) {\n      this._lastWillFocusKey = undefined;\n    }\n\n    if (this._lastWillBlurKey === target) {\n      return;\n    }\n\n    this._lastDidBlurKey = undefined;\n    this._lastWillBlurKey = target;\n\n    const { navigation, onEvent } = this.props;\n\n    onEvent(target, 'willBlur', payload);\n\n    if (\n      typeof navigation.state.isTransitioning !== 'boolean' ||\n      (navigation.state.isTransitioning !== true &&\n        !navigation.dangerouslyGetParent())\n    ) {\n      this._emitDidBlur(target, payload);\n    }\n  };\n\n  /**\n   * @param {string} target\n   * @param {Payload} payload\n   */\n  _emitDidFocus = (target, payload) => {\n    if (this._lastWillFocusKey !== target || this._lastDidFocusKey === target) {\n      return;\n    }\n\n    this._lastDidFocusKey = target;\n\n    const { onEvent } = this.props;\n\n    onEvent(target, 'didFocus', payload);\n  };\n\n  /**\n   * @param {string} target\n   * @param {Payload} payload\n   */\n  _emitDidBlur = (target, payload) => {\n    if (this._lastWillBlurKey !== target || this._lastDidBlurKey === target) {\n      return;\n    }\n\n    this._lastDidBlurKey = target;\n\n    const { onEvent } = this.props;\n\n    onEvent(target, 'didBlur', payload);\n  };\n\n  render() {\n    return null;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}