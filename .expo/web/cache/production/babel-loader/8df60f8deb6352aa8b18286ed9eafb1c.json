{"ast":null,"code":"function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{PermissionStatus}from\"./Permissions.types\";function _getUserMedia(constraints){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){return navigator.mediaDevices.getUserMedia(constraints);}var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||function(){var error=new Error('Permission unimplemented');error.code=0;error.name='NotAllowedError';throw error;};return new Promise(function(resolve,reject){getUserMedia.call(navigator,constraints,resolve,reject);});}function askForMediaPermissionAsync(options){var message;return _regeneratorRuntime.async(function askForMediaPermissionAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(_getUserMedia(options));case 3:return _context.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);message=_context.t0.message;if(!(message==='Permission dismissed')){_context.next=13;break;}return _context.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 13:return _context.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});case 14:case\"end\":return _context.stop();}}},null,null,[[0,6]],Promise);}function askForMicrophonePermissionAsync(){return _regeneratorRuntime.async(function askForMicrophonePermissionAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(askForMediaPermissionAsync({audio:true}));case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},null,null,null,Promise);}function askForCameraPermissionAsync(){return _regeneratorRuntime.async(function askForCameraPermissionAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(askForMediaPermissionAsync({video:true}));case 2:return _context3.abrupt(\"return\",_context3.sent);case 3:case\"end\":return _context3.stop();}}},null,null,null,Promise);}function askForLocationPermissionAsync(){return _regeneratorRuntime.async(function askForLocationPermissionAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",new Promise(function(resolve){navigator.geolocation.getCurrentPosition(function(){return resolve({status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});},function(_ref2){var code=_ref2.code;if(code===1){resolve({status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});}else{resolve({status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});}});}));case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);}function getPermissionWithQueryAsync(name){var _await$navigator$perm,state;return _regeneratorRuntime.async(function getPermissionWithQueryAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(!navigator||!navigator.permissions||!navigator.permissions.query)){_context5.next=2;break;}return _context5.abrupt(\"return\",null);case 2:_context5.next=4;return _regeneratorRuntime.awrap(navigator.permissions.query({name:name}));case 4:_await$navigator$perm=_context5.sent;state=_await$navigator$perm.state;if(!(state==='prompt')){_context5.next=10;break;}return _context5.abrupt(\"return\",PermissionStatus.UNDETERMINED);case 10:if(!(state==='granted')){_context5.next=14;break;}return _context5.abrupt(\"return\",PermissionStatus.GRANTED);case 14:if(!(state==='denied')){_context5.next=16;break;}return _context5.abrupt(\"return\",PermissionStatus.DENIED);case 16:return _context5.abrupt(\"return\",null);case 17:case\"end\":return _context5.stop();}}},null,null,null,Promise);}function enumerateDevices(){return _regeneratorRuntime.async(function enumerateDevices$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)){_context6.next=4;break;}_context6.next=3;return _regeneratorRuntime.awrap(navigator.mediaDevices.enumerateDevices());case 3:return _context6.abrupt(\"return\",_context6.sent);case 4:if(!(window.MediaStreamTrack&&typeof window.MediaStreamTrack.getSources==='function')){_context6.next=8;break;}_context6.next=7;return _regeneratorRuntime.awrap(MediaStreamTrack.getSources());case 7:return _context6.abrupt(\"return\",_context6.sent);case 8:return _context6.abrupt(\"return\",null);case 9:case\"end\":return _context6.stop();}}},null,null,null,Promise);}function askSensorPermissionAsync(){var requestPermission,status;return _regeneratorRuntime.async(function askSensorPermissionAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:requestPermission=getRequestMotionPermission();if(requestPermission){_context7.next=3;break;}return _context7.abrupt(\"return\",PermissionStatus.GRANTED);case 3:_context7.next=5;return _regeneratorRuntime.awrap(requestPermission());case 5:status=_context7.sent;_context7.t0=status;_context7.next=_context7.t0==='granted'?9:_context7.t0==='denied'?10:11;break;case 9:return _context7.abrupt(\"return\",PermissionStatus.GRANTED);case 10:return _context7.abrupt(\"return\",PermissionStatus.DENIED);case 11:return _context7.abrupt(\"return\",PermissionStatus.UNDETERMINED);case 12:case\"end\":return _context7.stop();}}},null,null,null,Promise);}function getMediaMaybeGrantedAsync(targetKind){var devices,result;return _regeneratorRuntime.async(function getMediaMaybeGrantedAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return _regeneratorRuntime.awrap(enumerateDevices());case 2:devices=_context8.sent;if(devices){_context8.next=5;break;}return _context8.abrupt(\"return\",false);case 5:_context8.next=7;return _regeneratorRuntime.awrap(devices.filter(function(_ref3){var kind=_ref3.kind;return kind===targetKind;}).some(function(_ref4){var label=_ref4.label;return label!=='';}));case 7:result=_context8.sent;return _context8.abrupt(\"return\",result);case 9:case\"end\":return _context8.stop();}}},null,null,null,Promise);}function getPermissionAsync(permission,shouldAsk){var status,_window,_window$Notification,Notification,_status,_status3,_status2,maybeStatus,_maybeStatus,maybeGranted,_maybeStatus2,_maybeGranted;return _regeneratorRuntime.async(function getPermissionAsync$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.t0=permission;_context9.next=_context9.t0==='userFacingNotifications'?3:_context9.t0==='notifications'?3:_context9.t0==='motion'?20:_context9.t0==='location'?27:_context9.t0==='locationForeground'?27:_context9.t0==='locationBackground'?27:_context9.t0==='audioRecording'?43:_context9.t0==='camera'?66:89;break;case 3:if(shouldAsk){_context9.next=9;break;}_context9.next=6;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('notifications'));case 6:status=_context9.sent;if(!status){_context9.next=9;break;}return _context9.abrupt(\"return\",{status:status,expires:'never',granted:status===PermissionStatus.GRANTED,canAskAgain:true});case 9:_window=window,_window$Notification=_window.Notification,Notification=_window$Notification===void 0?{}:_window$Notification;if(!Notification.requestPermission){_context9.next=19;break;}_status=Notification.permission;if(!shouldAsk){_context9.next=16;break;}_context9.next=15;return _regeneratorRuntime.awrap(Notification.requestPermission());case 15:_status=_context9.sent;case 16:if(!(!_status||_status==='default')){_context9.next=18;break;}return _context9.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 18:return _context9.abrupt(\"return\",{status:_status,expires:'never',canAskAgain:true,granted:_status===PermissionStatus.GRANTED});case 19:return _context9.abrupt(\"break\",90);case 20:if(!shouldAsk){_context9.next=25;break;}_context9.next=23;return _regeneratorRuntime.awrap(askSensorPermissionAsync());case 23:_status3=_context9.sent;return _context9.abrupt(\"return\",{status:_status3,expires:'never',granted:_status3===PermissionStatus.GRANTED,canAskAgain:false});case 25:_status2=getRequestMotionPermission()?PermissionStatus.UNDETERMINED:isIOS()?PermissionStatus.DENIED:PermissionStatus.GRANTED;return _context9.abrupt(\"return\",{status:_status2,expires:'never',canAskAgain:true,granted:_status2===PermissionStatus.GRANTED});case 27:_context9.next=29;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('geolocation'));case 29:maybeStatus=_context9.sent;if(!maybeStatus){_context9.next=38;break;}if(!(maybeStatus===PermissionStatus.UNDETERMINED&&shouldAsk)){_context9.next=35;break;}_context9.next=34;return _regeneratorRuntime.awrap(askForLocationPermissionAsync());case 34:return _context9.abrupt(\"return\",_context9.sent);case 35:return _context9.abrupt(\"return\",{status:maybeStatus,expires:'never',canAskAgain:true,granted:maybeStatus===PermissionStatus.GRANTED});case 38:if(!shouldAsk){_context9.next=42;break;}_context9.next=41;return _regeneratorRuntime.awrap(askForLocationPermissionAsync());case 41:return _context9.abrupt(\"return\",_context9.sent);case 42:return _context9.abrupt(\"break\",90);case 43:_context9.next=45;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('microphone'));case 45:_maybeStatus=_context9.sent;if(!_maybeStatus){_context9.next=54;break;}if(!(_maybeStatus===PermissionStatus.UNDETERMINED&&shouldAsk)){_context9.next=51;break;}_context9.next=50;return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());case 50:return _context9.abrupt(\"return\",_context9.sent);case 51:return _context9.abrupt(\"return\",{status:_maybeStatus,expires:'never',canAskAgain:true,granted:_maybeStatus===PermissionStatus.GRANTED});case 54:if(!shouldAsk){_context9.next=60;break;}_context9.next=57;return _regeneratorRuntime.awrap(askForMicrophonePermissionAsync());case 57:return _context9.abrupt(\"return\",_context9.sent);case 60:_context9.next=62;return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('audioinput'));case 62:maybeGranted=_context9.sent;if(!maybeGranted){_context9.next=65;break;}return _context9.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 65:return _context9.abrupt(\"break\",90);case 66:_context9.next=68;return _regeneratorRuntime.awrap(getPermissionWithQueryAsync('camera'));case 68:_maybeStatus2=_context9.sent;if(!_maybeStatus2){_context9.next=77;break;}if(!(_maybeStatus2===PermissionStatus.UNDETERMINED&&shouldAsk)){_context9.next=74;break;}_context9.next=73;return _regeneratorRuntime.awrap(askForCameraPermissionAsync());case 73:return _context9.abrupt(\"return\",_context9.sent);case 74:return _context9.abrupt(\"return\",{status:_maybeStatus2,expires:'never',canAskAgain:true,granted:_maybeStatus2===PermissionStatus.GRANTED});case 77:if(!shouldAsk){_context9.next=83;break;}_context9.next=80;return _regeneratorRuntime.awrap(askForCameraPermissionAsync());case 80:return _context9.abrupt(\"return\",_context9.sent);case 83:_context9.next=85;return _regeneratorRuntime.awrap(getMediaMaybeGrantedAsync('videoinput'));case 85:_maybeGranted=_context9.sent;if(!_maybeGranted){_context9.next=88;break;}return _context9.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 88:return _context9.abrupt(\"break\",90);case 89:return _context9.abrupt(\"break\",90);case 90:return _context9.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 91:case\"end\":return _context9.stop();}}},null,null,null,Promise);}export default{get name(){return'ExpoPermissions';},getAsync:function getAsync(permissionTypes){var results,_iterator,_step,permissionType;return _regeneratorRuntime.async(function getAsync$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:results={};_iterator=_createForOfIteratorHelperLoose(new Set(permissionTypes));case 2:if((_step=_iterator()).done){_context10.next=9;break;}permissionType=_step.value;_context10.next=6;return _regeneratorRuntime.awrap(getPermissionAsync(permissionType,false));case 6:results[permissionType]=_context10.sent;case 7:_context10.next=2;break;case 9:return _context10.abrupt(\"return\",results);case 10:case\"end\":return _context10.stop();}}},null,null,null,Promise);},askAsync:function askAsync(permissionTypes){var results,_iterator2,_step2,permissionType;return _regeneratorRuntime.async(function askAsync$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:results={};_iterator2=_createForOfIteratorHelperLoose(new Set(permissionTypes));case 2:if((_step2=_iterator2()).done){_context11.next=9;break;}permissionType=_step2.value;_context11.next=6;return _regeneratorRuntime.awrap(getPermissionAsync(permissionType,true));case 6:results[permissionType]=_context11.sent;case 7:_context11.next=2;break;case 9:return _context11.abrupt(\"return\",results);case 10:case\"end\":return _context11.stop();}}},null,null,null,Promise);}};export function getRequestMotionPermission(){var _DeviceMotionEvent;if(typeof DeviceMotionEvent!=='undefined'&&!!((_DeviceMotionEvent=DeviceMotionEvent)!=null&&_DeviceMotionEvent.requestPermission)){return DeviceMotionEvent.requestPermission;}return null;}function isIOS(){var isIOSUA=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);var isIE11=!!window['MSStream'];return isIOSUA&&!isIE11;}","map":{"version":3,"sources":["../src/ExpoPermissions.web.ts"],"names":[],"mappings":"umCAAA,OAGE,gBAHF,2BAcA,QAAS,CAAA,aAAT,CAAuB,WAAvB,CAA0D,CACxD,GAAI,SAAS,CAAC,YAAV,EAA0B,SAAS,CAAC,YAAV,CAAuB,YAArD,CAAmE,CACjE,MAAO,CAAA,SAAS,CAAC,YAAV,CAAuB,YAAvB,CAAoC,WAApC,CAAP,CACD,CAOD,GAAM,CAAA,YAAY,CAChB,SAAS,CAAC,YAAV,EACC,SAAiB,CAAC,kBADnB,EAEC,SAAiB,CAAC,eAFnB,EAGA,UAAA,CACE,GAAM,CAAA,KAAK,CAAQ,GAAI,CAAA,KAAJ,CAAU,0BAAV,CAAnB,CACA,KAAK,CAAC,IAAN,CAAa,CAAb,CACA,KAAK,CAAC,IAAN,CAAa,iBAAb,CACA,KAAM,CAAA,KAAN,CACD,CATH,CAWA,MAAO,IAAI,CAAA,OAAJ,CAAY,SAAC,OAAD,CAAU,MAAV,CAAoB,CACrC,YAAY,CAAC,IAAb,CAAkB,SAAlB,CAA6B,WAA7B,CAA0C,OAA1C,CAAmD,MAAnD,EACD,CAFM,CAAP,CAGD,CAED,QAAe,CAAA,0BAAf,CACE,OADF,mNAIU,aAAa,CAAC,OAAD,CAJvB,yCAKW,CACL,MAAM,CAAE,gBAAgB,CAAC,OADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,IAJJ,CALX,0DAWa,OAXb,aAWa,OAXb,MAcQ,OAAO,GAAK,sBAdpB,2DAgBa,CACL,MAAM,CAAE,gBAAgB,CAAC,YADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,KAJJ,CAhBb,0CA0Ba,CACL,MAAM,CAAE,gBAAgB,CAAC,MADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,KAJJ,CA1Bb,2EAoCA,QAAe,CAAA,+BAAf,iMACe,0BAA0B,CAAC,CAAE,KAAK,CAAE,IAAT,CAAD,CADzC,gIAIA,QAAe,CAAA,2BAAf,6LACe,0BAA0B,CAAC,CAAE,KAAK,CAAE,IAAT,CAAD,CADzC,gIAIA,QAAe,CAAA,6BAAf,8KACS,GAAI,CAAA,OAAJ,CAAY,SAAA,OAAO,CAAG,CAC3B,SAAS,CAAC,WAAV,CAAsB,kBAAtB,CACE,iBACE,CAAA,OAAO,CAAC,CACN,MAAM,CAAE,gBAAgB,CAAC,OADnB,CAEN,OAAO,CAAE,OAFH,CAGN,WAAW,CAAE,IAHP,CAIN,OAAO,CAAE,IAJH,CAAD,CADT,EADF,CAQE,eAA4B,IAAzB,CAAA,IAAyB,OAAzB,IAAyB,CAE1B,GAAI,IAAI,GAAK,CAAb,CAAgB,CACd,OAAO,CAAC,CACN,MAAM,CAAE,gBAAgB,CAAC,MADnB,CAEN,OAAO,CAAE,OAFH,CAGN,WAAW,CAAE,IAHP,CAIN,OAAO,CAAE,KAJH,CAAD,CAAP,CAMD,CAPD,IAOO,CACL,OAAO,CAAC,CACN,MAAM,CAAE,gBAAgB,CAAC,YADnB,CAEN,OAAO,CAAE,OAFH,CAGN,WAAW,CAAE,IAHP,CAIN,OAAO,CAAE,KAJH,CAAD,CAAP,CAMD,CACF,CAzBH,EA2BD,CA5BM,CADT,wEAgCA,QAAe,CAAA,2BAAf,CAA2C,IAA3C,+KACM,CAAC,SAAD,EAAc,CAAC,SAAS,CAAC,WAAzB,EAAwC,CAAC,SAAS,CAAC,WAAV,CAAsB,KADrE,4DACmF,IADnF,2DAG0B,SAAS,CAAC,WAAV,CAAsB,KAAtB,CAA4B,CAAE,IAAI,CAAJ,IAAF,CAA5B,CAH1B,8CAGU,KAHV,uBAGU,KAHV,MAIM,KAAK,GAAK,QAJhB,6DAKW,gBAAgB,CAAC,YAL5B,eAMa,KAAK,GAAK,SANvB,6DAOW,gBAAgB,CAAC,OAP5B,eAQa,KAAK,GAAK,QARvB,6DASW,gBAAgB,CAAC,MAT5B,2CAWS,IAXT,yEAcA,QAAe,CAAA,gBAAf,qIACM,SAAS,EAAI,SAAS,CAAC,YAAvB,EAAuC,SAAS,CAAC,YAAV,CAAuB,gBADpE,6EAEiB,SAAS,CAAC,YAAV,CAAuB,gBAAvB,EAFjB,sEAMM,MAAM,CAAC,gBAAP,EAA2B,MAAO,CAAA,MAAM,CAAC,gBAAP,CAAwB,UAA/B,GAA8C,UAN/E,6EAQiB,gBAAgB,CAAC,UAAjB,EARjB,kGAUS,IAVT,wEAaA,QAAe,CAAA,wBAAf,qKACQ,iBADR,CAC4B,0BAA0B,EADtD,IAIO,iBAJP,2DAIiC,gBAAgB,CAAC,OAJlD,2DAQuB,iBAAiB,EARxC,SAQQ,MARR,6BASU,MATV,+BAUS,SAVT,kBAYS,QAZT,qDAWa,gBAAgB,CAAC,OAX9B,2CAaa,gBAAgB,CAAC,MAb9B,2CAea,gBAAgB,CAAC,YAf9B,yEAmBA,QAAe,CAAA,yBAAf,CAAyC,UAAzC,6MACwB,gBAAgB,EADxC,SACQ,OADR,mBAEO,OAFP,2DAGW,KAHX,2DAKuB,OAAO,CACzB,MADkB,CACX,mBAAG,CAAA,IAAH,OAAG,IAAH,OAAc,CAAA,IAAI,GAAK,UAAvB,EADW,EAElB,IAFkB,CAEb,mBAAG,CAAA,KAAH,OAAG,KAAH,OAAe,CAAA,KAAK,GAAK,EAAzB,EAFa,CALvB,SAKQ,MALR,iDASS,MATT,wEAYA,QAAe,CAAA,kBAAf,CACE,UADF,CAEE,SAFF,+RAIU,UAJV,+BAKS,yBALT,kBAMS,eANT,kBA2CS,QA3CT,mBAmES,UAnET,mBAoES,oBApET,mBAqES,oBArET,mBAwFS,gBAxFT,mBAqHS,QArHT,uBAQa,SARb,4EAS+B,2BAA2B,CAAC,eAAD,CAT1D,SASgB,MAThB,oBAUc,MAVd,2DAWmB,CACL,MAAM,CAAN,MADK,CAEL,OAAO,CAAE,OAFJ,CAGL,OAAO,CAAE,MAAM,GAAK,gBAAgB,CAAC,OAHhC,CAIL,WAAW,CAAE,IAJR,CAXnB,iBAoBsC,MApBtC,8BAoBgB,YApBhB,CAoBgB,YApBhB,+BAoB+B,EApB/B,0BAqBY,YAAY,CAAC,iBArBzB,2BAsBc,OAtBd,CAsBuB,YAAY,CAAC,UAtBpC,KAuBc,SAvBd,8EAwB2B,YAAY,CAAC,iBAAb,EAxB3B,UAwBY,OAxBZ,6BA0Bc,CAAC,OAAD,EAAW,OAAM,GAAK,SA1BpC,6DA2BmB,CACL,MAAM,CAAE,gBAAgB,CAAC,YADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,KAJJ,CA3BnB,2CAkCiB,CACL,MAAM,CAAN,OADK,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,OAAM,GAAK,gBAAgB,CAAC,OAJhC,CAlCjB,0DA4CU,SA5CV,8EA6C6B,wBAAwB,EA7CrD,UA6Cc,QA7Cd,iDA8Ce,CACL,MAAM,CAAN,QADK,CAEL,OAAO,CAAE,OAFJ,CAGL,OAAO,CAAE,QAAM,GAAK,gBAAgB,CAAC,OAHhC,CAIL,WAAW,CAAE,KAJR,CA9Cf,UAuDY,QAvDZ,CAuDqB,0BAA0B,GACrC,gBAAgB,CAAC,YADoB,CAErC,KAAK,GACL,gBAAgB,CAAC,MADZ,CAEL,gBAAgB,CAAC,OA3D3B,kCA4Da,CACL,MAAM,CAAN,QADK,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,QAAM,GAAK,gBAAgB,CAAC,OAJhC,CA5Db,6DAuEkC,2BAA2B,CAAC,aAAD,CAvE7D,UAuEc,WAvEd,oBAwEY,WAxEZ,gCAyEc,WAAW,GAAK,gBAAgB,CAAC,YAAjC,EAAiD,SAzE/D,+EA0EyB,6BAA6B,EA1EtD,oGA4EiB,CACL,MAAM,CAAE,WADH,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,WAAW,GAAK,gBAAgB,CAAC,OAJrC,CA5EjB,cAkFmB,SAlFnB,8EAoFuB,6BAA6B,EApFpD,kKA0FkC,2BAA2B,CAAC,YAAD,CA1F7D,UA0Fc,YA1Fd,oBA2FY,YA3FZ,gCA4Fc,YAAW,GAAK,gBAAgB,CAAC,YAAjC,EAAiD,SA5F/D,+EA6FyB,+BAA+B,EA7FxD,oGA+FiB,CACL,MAAM,CAAE,YADH,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,YAAW,GAAK,gBAAgB,CAAC,OAJrC,CA/FjB,cAqGmB,SArGnB,8EAsGuB,+BAA+B,EAtGtD,sHAwGqC,yBAAyB,CAAC,YAAD,CAxG9D,UAwGgB,YAxGhB,oBAyGc,YAzGd,4DA0GmB,CACL,MAAM,CAAE,gBAAgB,CAAC,OADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,IAJJ,CA1GnB,yGAuHkC,2BAA2B,CAAC,QAAD,CAvH7D,UAuHc,aAvHd,oBAwHY,aAxHZ,gCAyHc,aAAW,GAAK,gBAAgB,CAAC,YAAjC,EAAiD,SAzH/D,+EA0HyB,2BAA2B,EA1HpD,oGA4HiB,CACL,MAAM,CAAE,aADH,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,aAAW,GAAK,gBAAgB,CAAC,OAJrC,CA5HjB,cAkImB,SAlInB,8EAmIuB,2BAA2B,EAnIlD,sHAqIqC,yBAAyB,CAAC,YAAD,CArI9D,UAqIgB,aArIhB,oBAsIc,aAtId,4DAuImB,CACL,MAAM,CAAE,gBAAgB,CAAC,OADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,IAJJ,CAvInB,mIAqJS,CACL,MAAM,CAAE,gBAAgB,CAAC,YADpB,CAEL,OAAO,CAAE,OAFJ,CAGL,WAAW,CAAE,IAHR,CAIL,OAAO,CAAE,KAJJ,CArJT,yEA6JA,cAAe,CACb,GAAI,CAAA,IAAJ,EAAQ,CACN,MAAO,iBAAP,CACD,CAHY,CAKP,QALO,mBAKE,eALF,qKAML,OANK,CAMK,EANL,2CAOkB,GAAI,CAAA,GAAJ,CAAQ,eAAR,CAPlB,+DAOA,cAPA,gEAQuB,kBAAkB,CAAC,cAAD,CAAiC,KAAjC,CARzC,SAQT,OAAO,CAAC,cAAD,CARE,yFAUJ,OAVI,2EAaP,QAbO,mBAaE,eAbF,uKAcL,OAdK,CAcK,EAdL,4CAekB,GAAI,CAAA,GAAJ,CAAQ,eAAR,CAflB,iEAeA,cAfA,iEAgBuB,kBAAkB,CAAC,cAAD,CAAiC,IAAjC,CAhBzC,SAgBT,OAAO,CAAC,cAAD,CAhBE,yFAkBJ,OAlBI,2EAAf,CAsBA,MAAM,SAAU,CAAA,0BAAV,EAAoC,wBACxC,GAAI,MAAO,CAAA,iBAAP,GAA6B,WAA7B,EAA4C,CAAC,sBAAC,iBAAD,SAAC,mBAAmB,iBAApB,CAAjD,CAAwF,CACtF,MAAO,CAAA,iBAAiB,CAAC,iBAAzB,CACD,CAED,MAAO,KAAP,CACD,CAGD,QAAS,CAAA,KAAT,EAAc,CACZ,GAAM,CAAA,OAAO,CAAG,sBAAsB,IAAtB,CAA2B,SAAS,CAAC,SAArC,CAAhB,CACA,GAAM,CAAA,MAAM,CAAG,CAAC,CAAC,MAAM,CAAC,UAAD,CAAvB,CACA,MAAO,CAAA,OAAO,EAAI,CAAC,MAAnB,CACD","sourcesContent":["import {\n  PermissionMap,\n  PermissionType,\n  PermissionStatus,\n  PermissionInfo,\n} from './Permissions.types';\n\n/*\n * TODO: Bacon: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Permissions\n * Add messages to manifest like we do with iOS info.plist\n */\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nfunction _getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    navigator.getUserMedia ||\n    (navigator as any).webkitGetUserMedia ||\n    (navigator as any).mozGetUserMedia ||\n    function() {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nasync function askForMediaPermissionAsync(\n  options: MediaStreamConstraints\n): Promise<PermissionInfo> {\n  try {\n    await _getUserMedia(options);\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    // name: NotAllowedError\n    // code: 0\n    if (message === 'Permission dismissed') {\n      // message: Permission dismissed\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    } else {\n      // TODO: Bacon: [OSX] The system could deny access to chrome.\n      // TODO: Bacon: add: { status: 'unimplemented' }\n      // message: Permission denied\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    }\n  }\n}\n\nasync function askForMicrophonePermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ audio: true });\n}\n\nasync function askForCameraPermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ video: true });\n}\n\nasync function askForLocationPermissionAsync(): Promise<PermissionInfo> {\n  return new Promise(resolve => {\n    navigator.geolocation.getCurrentPosition(\n      () =>\n        resolve({\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true,\n        }),\n      ({ code }: PositionError) => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/PositionError/code\n        if (code === 1) {\n          resolve({\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        } else {\n          resolve({\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        }\n      }\n    );\n  });\n}\n\nasync function getPermissionWithQueryAsync(name: PermissionName): Promise<PermissionStatus | null> {\n  if (!navigator || !navigator.permissions || !navigator.permissions.query) return null;\n\n  const { state } = await navigator.permissions.query({ name });\n  if (state === 'prompt') {\n    return PermissionStatus.UNDETERMINED;\n  } else if (state === 'granted') {\n    return PermissionStatus.GRANTED;\n  } else if (state === 'denied') {\n    return PermissionStatus.DENIED;\n  }\n  return null;\n}\n\nasync function enumerateDevices(): Promise<MediaDeviceInfo[] | null> {\n  if (navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n    return await navigator.mediaDevices.enumerateDevices();\n  }\n\n  // @ts-ignore: This is deprecated but we should still attempt to use it.\n  if (window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function') {\n    // @ts-ignore\n    return await MediaStreamTrack.getSources();\n  }\n  return null;\n}\n\nasync function askSensorPermissionAsync(): Promise<PermissionStatus> {\n  const requestPermission = getRequestMotionPermission();\n  // Technically this is incorrect because it doesn't account for iOS 12.2 Safari.\n  // But unfortunately we can only abstract so much.\n  if (!requestPermission) return PermissionStatus.GRANTED;\n\n  // If this isn't invoked in a touch-event then it never resolves.\n  // Safari probably should throw an error but because it doesn't we have no way of informing the developer.\n  const status = await requestPermission();\n  switch (status) {\n    case 'granted':\n      return PermissionStatus.GRANTED;\n    case 'denied':\n      return PermissionStatus.DENIED;\n    default:\n      return PermissionStatus.UNDETERMINED;\n  }\n}\n\nasync function getMediaMaybeGrantedAsync(targetKind: MediaDeviceKind): Promise<boolean> {\n  const devices = await enumerateDevices();\n  if (!devices) {\n    return false;\n  }\n  const result = await devices\n    .filter(({ kind }) => kind === targetKind)\n    .some(({ label }) => label !== '');\n  // Granted or denied or undetermined or no devices\n  return result;\n}\n\nasync function getPermissionAsync(\n  permission: PermissionType,\n  shouldAsk: boolean\n): Promise<PermissionInfo> {\n  switch (permission) {\n    case 'userFacingNotifications':\n    case 'notifications':\n      {\n        if (!shouldAsk) {\n          const status = await getPermissionWithQueryAsync('notifications');\n          if (status) {\n            return {\n              status,\n              expires: 'never',\n              granted: status === PermissionStatus.GRANTED,\n              canAskAgain: true,\n            };\n          }\n        }\n\n        const { Notification = {} } = window as any;\n        if (Notification.requestPermission) {\n          let status = Notification.permission;\n          if (shouldAsk) {\n            status = await Notification.requestPermission();\n          }\n          if (!status || status === 'default') {\n            return {\n              status: PermissionStatus.UNDETERMINED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: false,\n            };\n          }\n          return {\n            status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: status === PermissionStatus.GRANTED,\n          };\n        }\n      }\n      break;\n    case 'motion': {\n      if (shouldAsk) {\n        const status = await askSensorPermissionAsync();\n        return {\n          status,\n          expires: 'never',\n          granted: status === PermissionStatus.GRANTED,\n          canAskAgain: false,\n        };\n      }\n\n      // We can infer from the requestor if this is an older browser.\n      const status = getRequestMotionPermission()\n        ? PermissionStatus.UNDETERMINED\n        : isIOS()\n        ? PermissionStatus.DENIED\n        : PermissionStatus.GRANTED;\n      return {\n        status,\n        expires: 'never',\n        canAskAgain: true,\n        granted: status === PermissionStatus.GRANTED,\n      };\n    }\n    case 'location':\n    case 'locationForeground':\n    case 'locationBackground':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('geolocation');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForLocationPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          // TODO: Bacon: should this function as ask async when not in chrome?\n          return await askForLocationPermissionAsync();\n        }\n      }\n      break;\n    case 'audioRecording':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('microphone');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForMicrophonePermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForMicrophonePermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('audioinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    case 'camera':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('camera');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForCameraPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForCameraPermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('videoinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    default:\n      break;\n  }\n  return {\n    status: PermissionStatus.UNDETERMINED,\n    expires: 'never',\n    canAskAgain: true,\n    granted: false,\n  };\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoPermissions';\n  },\n\n  async getAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ false);\n    }\n    return results;\n  },\n\n  async askAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ true);\n    }\n    return results;\n  },\n};\n\nexport function getRequestMotionPermission(): (() => Promise<PermissionState>) | null {\n  if (typeof DeviceMotionEvent !== 'undefined' && !!DeviceMotionEvent?.requestPermission) {\n    return DeviceMotionEvent.requestPermission;\n  }\n\n  return null;\n}\n\n// https://stackoverflow.com/a/9039885/4047926\nfunction isIOS(): boolean {\n  const isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  const isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}