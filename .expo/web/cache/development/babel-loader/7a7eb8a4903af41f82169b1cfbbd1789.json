{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\Mudrank Gupta\\\\OneDrive\\\\WHJR\\\\Pro\\\\Wireless-Library-management\\\\Screens\\\\Transaction.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport * as Permissions from \"expo-permissions\";\nimport { BarCodeScanner } from \"expo-barcode-scanner\";\nimport { Camera } from \"expo-camera\";\nimport Icon from \"@expo/vector-icons/FontAwesome5\";\nimport firebase from \"firebase\";\nimport db from \"../config\";\n\nvar Transaction = function (_React$Component) {\n  _inherits(Transaction, _React$Component);\n\n  var _super = _createSuper(Transaction);\n\n  function Transaction() {\n    var _this;\n\n    _classCallCheck(this, Transaction);\n\n    _this = _super.call(this);\n\n    _this.getCamPermissions = function _callee(id) {\n      var _await$Permissions$as, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.CAMERA));\n\n            case 2:\n              _await$Permissions$as = _context.sent;\n              status = _await$Permissions$as.status;\n              console.log(status);\n\n              _this.setState({\n                hasPermission: status === \"granted\",\n                btnState: id,\n                scanned: false\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.handleScan = function _callee2(_ref) {\n      var type, data, btnState;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              type = _ref.type, data = _ref.data;\n              btnState = _this.state.btnState;\n\n              if (btnState === \"bookId\") {\n                _this.setState({\n                  scanned: true,\n                  scannedBookId: data,\n                  btnState: \"normal\"\n                });\n              } else if (btnState === \"studentId\") {\n                _this.setState({\n                  scanned: true,\n                  scannedStudentId: data,\n                  btnState: \"normal\"\n                });\n              }\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.handleTransaction = function _callee3() {\n      var transactionMsg;\n      return _regeneratorRuntime.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              db.collection(\"Book\").doc(_this.state.scannedBookId).get().then(function (doc) {\n                console.log(doc);\n                var book = doc.data();\n\n                if (book.bookAvailablity) {\n                  _this.InitializeBookIssue();\n\n                  transactionMsg = \"Book issued\";\n                } else {\n                  _this.InitializeBookReturn();\n\n                  transactionMsg = \"Book returned\";\n                }\n\n                _this.setState({\n                  transactionMsg: transactionMsg\n                });\n              });\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.InitializeBookIssue = function _callee4() {\n      return _regeneratorRuntime.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              db.collection(\"Transactions\").add({\n                'studentId': _this.state.scannedStudentId,\n                'bookId': _this.state.scannedBookId,\n                'date': firebase.firestore.Timestamp.now().toDate(),\n                'transactionType': 'issued'\n              });\n              db.collection(\"Books\").doc(_this.state.scannedBookId).update({\n                'bookAvailablity': false\n              });\n              db.collection(\"Students\").doc(_this.state.scannedStudentId).update({\n                'noOfBooksIssued': firebase.firestore.FieldValue.increment(1)\n              });\n              alert('Book Issued');\n\n              _this.setState({\n                scannedStudentId: ' ',\n                scannedBookId: ' '\n              });\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.InitializeBookReturn = function _callee5() {\n      return _regeneratorRuntime.async(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              db.collection(\"Transactions\").add({\n                'studentId': _this.state.scannedStudentId,\n                'bookId': _this.state.scannedBookId,\n                'date': firebase.firestore.Timestamp.now().toDate(),\n                'transactionType': 'return'\n              });\n              db.collection(\"Books\").doc(_this.state.scannedBookId).update({\n                'bookAvailablity': true\n              });\n              db.collection(\"Students\").doc(_this.state.scannedStudentId).update({\n                'noOfBooksIssued': firebase.firestore.FieldValue.increment(-1)\n              });\n              alert('Book Returned');\n\n              _this.setState({\n                scannedStudentId: ' ',\n                scannedBookId: ' '\n              });\n\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.state = {\n      hasPermission: null,\n      scanned: false,\n      scannedStudentId: false,\n      scannedBookId: false,\n      scannedData: \" \",\n      btnState: \"normal\",\n      transactionMsg: \"\"\n    };\n    return _this;\n  }\n\n  _createClass(Transaction, [{\n    key: \"render\",\n    value: function render() {\n      if (this.state.hasPermission && this.state.btnState === true) {\n        return React.createElement(BarCodeScanner, {\n          onBarCodeScanned: this.state.scanned ? undefined : this.handleScan,\n          style: StyleSheet.absoluteFillObject,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 9\n          }\n        });\n      } else {\n        return React.createElement(View, {\n          style: styles.container,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 9\n          }\n        }, React.createElement(View, {\n          style: styles.row,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 11\n          }\n        }, React.createElement(Icon, {\n          style: styles.icon,\n          name: \"money-check\",\n          color: \"#7f5af0\",\n          size: 27,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 13\n          }\n        }), React.createElement(Text, {\n          style: styles.title,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }\n        }, \"Transactions\")), React.createElement(TextInput, {\n          placeholder: \"Student Id\",\n          keyboardAppearance: \"dark\",\n          style: styles.input,\n          value: this.state.scannedStudentId,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 11\n          }\n        }), React.createElement(TouchableOpacity, {\n          style: styles.scan,\n          onPress: this.getCamPermissions(studentId),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 11\n          }\n        }, React.createElement(Text, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 13\n          }\n        }, \"Scan Student Id \")), React.createElement(TextInput, {\n          placeholder: \"Book Id\",\n          keyboardAppearance: \"dark\",\n          style: styles.input,\n          value: this.state.scannedBookId,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 11\n          }\n        }), React.createElement(TouchableOpacity, {\n          style: styles.scan,\n          onPress: this.getCamPermissions(bookId),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168,\n            columnNumber: 11\n          }\n        }, React.createElement(Text, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 13\n          }\n        }, \"Scan Book Id \")), React.createElement(TouchableOpacity, {\n          style: styles.scan,\n          onPress: this.handleTransaction(),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 11\n          }\n        }, React.createElement(Text, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }\n        }, \"Submit \")));\n      }\n    }\n  }]);\n\n  return Transaction;\n}(React.Component);\n\nexport { Transaction as default };\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    backgroundColor: \"#16161a\"\n  },\n  row: {\n    flexDirection: \"row\"\n  },\n  icon: {\n    padding: 10\n  },\n  title: {\n    fontSize: 30,\n    fontWeight: \"bold\",\n    color: \"#fffffe\"\n  },\n  scan: {\n    alignItems: \"center\",\n    backgroundColor: \"#DDDDDD\",\n    padding: 10\n  }\n});","map":{"version":3,"sources":["C:/Users/Mudrank Gupta/OneDrive/WHJR/Pro/Wireless-Library-management/Screens/Transaction.js"],"names":["React","Permissions","BarCodeScanner","Camera","Icon","firebase","db","Transaction","getCamPermissions","id","askAsync","CAMERA","status","console","log","setState","hasPermission","btnState","scanned","handleScan","type","data","state","scannedBookId","scannedStudentId","handleTransaction","collection","doc","get","then","book","bookAvailablity","InitializeBookIssue","transactionMsg","InitializeBookReturn","add","firestore","Timestamp","now","toDate","update","FieldValue","increment","alert","scannedData","undefined","StyleSheet","absoluteFillObject","styles","container","row","icon","title","input","scan","studentId","bookId","Component","create","flex","alignItems","justifyContent","backgroundColor","flexDirection","padding","fontSize","fontWeight","color"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { StyleSheet, Text, View, TouchableOpacity } from \"react-native\";\r\nimport * as Permissions from \"expo-permissions\";\r\nimport { BarCodeScanner } from \"expo-barcode-scanner\";\r\nimport { Camera } from \"expo-camera\";\r\nimport Icon from \"react-native-vector-icons/FontAwesome5\";\r\n\r\nimport firebase from \"firebase\";\r\nimport db from \"../config\";\r\n\r\nexport default class Transaction extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      hasPermission: null,\r\n      scanned: false,\r\n      scannedStudentId: false,\r\n      scannedBookId: false,\r\n      scannedData: \" \",\r\n      btnState: \"normal\",\r\n      transactionMsg: \"\",\r\n    };\r\n  }\r\n\r\n  getCamPermissions = async (id) => {\r\n    const { status } = await Permissions.askAsync(Permissions.CAMERA);\r\n    console.log(status);\r\n    this.setState({\r\n      hasPermission: status === \"granted\",\r\n      btnState: id,\r\n      scanned: false,\r\n    });\r\n  };\r\n\r\n  handleScan = async ({ type, data }) => {\r\n    const { btnState } = this.state;\r\n\r\n    if (btnState === \"bookId\") {\r\n      this.setState({\r\n        scanned: true,\r\n        scannedBookId: data,\r\n        btnState: \"normal\",\r\n      });\r\n    } else if (btnState === \"studentId\") {\r\n      this.setState({\r\n        scanned: true,\r\n        scannedStudentId: data,\r\n        btnState: \"normal\",\r\n      });\r\n    }\r\n  };\r\n\r\n  handleTransaction = async () => {\r\n    var transactionMsg;\r\n    db.collection(\"Book\")\r\n      .doc(this.state.scannedBookId)\r\n      .get()\r\n      .then((doc) => {\r\n        console.log(doc);\r\n        var book = doc.data();\r\n\r\n        if (book.bookAvailablity) {\r\n          this.InitializeBookIssue();\r\n          transactionMsg = \"Book issued\";\r\n        } else {\r\n          this.InitializeBookReturn();\r\n          transactionMsg = \"Book returned\";\r\n        }\r\n\r\n        this.setState({\r\n          transactionMsg: transactionMsg,\r\n        });\r\n      });\r\n  };\r\n\r\n  InitializeBookIssue = async () => {\r\n    db.collection(\"Transactions\").add({\r\n      'studentId' : this.state.scannedStudentId,\r\n      'bookId' : this.state.scannedBookId,\r\n      'date' : firebase.firestore.Timestamp.now().toDate(),\r\n      'transactionType' : 'issued'\r\n    });\r\n    db.collection(\"Books\")\r\n    .doc(this.state.scannedBookId)\r\n    .update({\r\n      'bookAvailablity' : false,\r\n    })\r\n    db.collection(\"Students\")\r\n    .doc(this.state.scannedStudentId)\r\n    .update({\r\n      'noOfBooksIssued' : firebase.firestore.FieldValue.increment(1),\r\n    })\r\n    alert('Book Issued')\r\n\r\n    this.setState({\r\n      scannedStudentId: ' ',\r\n      scannedBookId: ' ',\r\n    })\r\n  };\r\n\r\n  InitializeBookReturn = async () => {\r\n    db.collection(\"Transactions\").add({\r\n      'studentId' : this.state.scannedStudentId,\r\n      'bookId' : this.state.scannedBookId,\r\n      'date' : firebase.firestore.Timestamp.now().toDate(),\r\n      'transactionType' : 'return'\r\n    });\r\n    db.collection(\"Books\")\r\n    .doc(this.state.scannedBookId)\r\n    .update({\r\n      'bookAvailablity' : true,\r\n    })\r\n    db.collection(\"Students\")\r\n    .doc(this.state.scannedStudentId)\r\n    .update({\r\n      'noOfBooksIssued' : firebase.firestore.FieldValue.increment(-1),\r\n    })\r\n    alert('Book Returned')\r\n\r\n    this.setState({\r\n      scannedStudentId: ' ',\r\n      scannedBookId: ' ',\r\n    })\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasPermission && this.state.btnState === true) {\r\n      return (\r\n        <BarCodeScanner\r\n          onBarCodeScanned={this.state.scanned ? undefined : this.handleScan}\r\n          style={StyleSheet.absoluteFillObject}\r\n        />\r\n      );\r\n    } else {\r\n      return (\r\n        <View style={styles.container}>\r\n          <View style={styles.row}>\r\n            <Icon\r\n              style={styles.icon}\r\n              name=\"money-check\"\r\n              color=\"#7f5af0\"\r\n              size={27}\r\n            />\r\n            <Text style={styles.title}>Transactions</Text>\r\n          </View>\r\n\r\n          <TextInput\r\n            placeholder=\"Student Id\"\r\n            keyboardAppearance=\"dark\"\r\n            style={styles.input}\r\n            value={this.state.scannedStudentId}\r\n          ></TextInput>\r\n\r\n          <TouchableOpacity\r\n            style={styles.scan}\r\n            onPress={this.getCamPermissions(studentId)}\r\n          >\r\n            <Text>Scan Student Id </Text>\r\n          </TouchableOpacity>\r\n\r\n          <TextInput\r\n            placeholder=\"Book Id\"\r\n            keyboardAppearance=\"dark\"\r\n            style={styles.input}\r\n            value={this.state.scannedBookId}\r\n          ></TextInput>\r\n\r\n          <TouchableOpacity\r\n            style={styles.scan}\r\n            onPress={this.getCamPermissions(bookId)}\r\n          >\r\n            <Text>Scan Book Id </Text>\r\n          </TouchableOpacity>\r\n\r\n          <TouchableOpacity\r\n            style={styles.scan}\r\n            onPress={this.handleTransaction()}\r\n          >\r\n            <Text>Submit </Text>\r\n          </TouchableOpacity>\r\n        </View>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    backgroundColor: \"#16161a\",\r\n  },\r\n  row: {\r\n    flexDirection: \"row\",\r\n  },\r\n  icon: {\r\n    padding: 10,\r\n  },\r\n  title: {\r\n    fontSize: 30,\r\n    fontWeight: \"bold\",\r\n    color: \"#fffffe\",\r\n  },\r\n  scan: {\r\n    alignItems: \"center\",\r\n    backgroundColor: \"#DDDDDD\",\r\n    padding: 10,\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}