{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{UnavailabilityError}from'@unimodules/core';import{CameraType,PermissionStatus}from\"./Camera.types\";import{canGetUserMedia,isBackCameraAvailableAsync,isFrontCameraAvailableAsync}from\"./WebUserMediaManager\";function getUserMedia(constraints){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){return navigator.mediaDevices.getUserMedia(constraints);}var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||function(){var error=new Error('Permission unimplemented');error.code=0;error.name='NotAllowedError';throw error;};return new Promise(function(resolve,reject){getUserMedia.call(navigator,constraints,resolve,reject);});}export default{get name(){return'ExponentCameraManager';},get Type(){return{back:'back',front:'front'};},get FlashMode(){return{on:'on',off:'off',auto:'auto',torch:'torch'};},get AutoFocus(){return{on:'on',off:'off',auto:'auto',singleShot:'singleShot'};},get WhiteBalance(){return{auto:'auto',continuous:'continuous',manual:'manual'};},get VideoQuality(){return{};},get VideoStabilization(){return{};},isAvailableAsync:function isAvailableAsync(){return _regeneratorRuntime.async(function isAvailableAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",canGetUserMedia());case 1:case\"end\":return _context.stop();}}},null,null,null,Promise);},takePicture:function takePicture(options,camera){return _regeneratorRuntime.async(function takePicture$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(camera.takePicture(options));case 2:return _context2.abrupt(\"return\",_context2.sent);case 3:case\"end\":return _context2.stop();}}},null,null,null,Promise);},pausePreview:function pausePreview(camera){return _regeneratorRuntime.async(function pausePreview$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(camera.pausePreview());case 2:case\"end\":return _context3.stop();}}},null,null,null,Promise);},resumePreview:function resumePreview(camera){return _regeneratorRuntime.async(function resumePreview$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(camera.resumePreview());case 2:return _context4.abrupt(\"return\",_context4.sent);case 3:case\"end\":return _context4.stop();}}},null,null,null,Promise);},getAvailableCameraTypesAsync:function getAvailableCameraTypesAsync(){var devices,types;return _regeneratorRuntime.async(function getAvailableCameraTypesAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(!canGetUserMedia()||!navigator.mediaDevices.enumerateDevices)){_context5.next=2;break;}return _context5.abrupt(\"return\",[]);case 2:_context5.next=4;return _regeneratorRuntime.awrap(navigator.mediaDevices.enumerateDevices());case 4:devices=_context5.sent;_context5.t0=_regeneratorRuntime;_context5.t1=Promise;_context5.next=9;return _regeneratorRuntime.awrap(isFrontCameraAvailableAsync(devices));case 9:_context5.t2=_context5.sent;if(!_context5.t2){_context5.next=12;break;}_context5.t2=CameraType.front;case 12:_context5.t3=_context5.t2;_context5.next=15;return _regeneratorRuntime.awrap(isBackCameraAvailableAsync());case 15:_context5.t4=_context5.sent;if(!_context5.t4){_context5.next=18;break;}_context5.t4=CameraType.back;case 18:_context5.t5=_context5.t4;_context5.t6=[_context5.t3,_context5.t5];_context5.t7=_context5.t1.all.call(_context5.t1,_context5.t6);_context5.next=23;return _context5.t0.awrap.call(_context5.t0,_context5.t7);case 23:types=_context5.sent;return _context5.abrupt(\"return\",types.filter(Boolean));case 25:case\"end\":return _context5.stop();}}},null,null,null,Promise);},getAvailablePictureSizes:function getAvailablePictureSizes(ratio,camera){return _regeneratorRuntime.async(function getAvailablePictureSizes$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return _regeneratorRuntime.awrap(camera.getAvailablePictureSizes(ratio));case 2:return _context6.abrupt(\"return\",_context6.sent);case 3:case\"end\":return _context6.stop();}}},null,null,null,Promise);},getPermissionsAsync:function getPermissionsAsync(){var _navigator,_navigator$permission;var _await$navigator$perm,state;return _regeneratorRuntime.async(function getPermissionsAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if((_navigator=navigator)!=null&&(_navigator$permission=_navigator.permissions)!=null&&_navigator$permission.query){_context7.next=2;break;}throw new UnavailabilityError('expo-camera','navigator.permissions API is not available');case 2:_context7.next=4;return _regeneratorRuntime.awrap(navigator.permissions.query({name:'camera'}));case 4:_await$navigator$perm=_context7.sent;state=_await$navigator$perm.state;_context7.t0=state;_context7.next=_context7.t0==='prompt'?9:_context7.t0==='granted'?10:_context7.t0==='denied'?11:12;break;case 9:return _context7.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 10:return _context7.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 11:return _context7.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});case 12:case\"end\":return _context7.stop();}}},null,null,null,Promise);},requestPermissionsAsync:function requestPermissionsAsync(){var message;return _regeneratorRuntime.async(function requestPermissionsAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;_context8.next=3;return _regeneratorRuntime.awrap(getUserMedia({video:true}));case 3:return _context8.abrupt(\"return\",{status:PermissionStatus.GRANTED,expires:'never',canAskAgain:true,granted:true});case 6:_context8.prev=6;_context8.t0=_context8[\"catch\"](0);message=_context8.t0.message;if(!(message==='Permission dismissed')){_context8.next=13;break;}return _context8.abrupt(\"return\",{status:PermissionStatus.UNDETERMINED,expires:'never',canAskAgain:true,granted:false});case 13:return _context8.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never',canAskAgain:true,granted:false});case 14:case\"end\":return _context8.stop();}}},null,null,[[0,6]],Promise);}};","map":{"version":3,"sources":["../src/ExponentCameraManager.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { UnavailabilityError } from '@unimodules/core';\n\nimport {\n  CameraCapturedPicture,\n  CameraPictureOptions,\n  CameraType,\n  PermissionResponse,\n  PermissionStatus,\n} from './Camera.types';\nimport { ExponentCameraRef } from './ExponentCamera.web';\nimport {\n  canGetUserMedia,\n  isBackCameraAvailableAsync,\n  isFrontCameraAvailableAsync,\n} from './WebUserMediaManager';\n\nfunction getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    navigator.getUserMedia ||\n    (navigator as any).webkitGetUserMedia ||\n    (navigator as any).mozGetUserMedia ||\n    function() {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nexport default {\n  get name(): string {\n    return 'ExponentCameraManager';\n  },\n  get Type() {\n    return {\n      back: 'back',\n      front: 'front',\n    };\n  },\n  get FlashMode() {\n    return {\n      on: 'on',\n      off: 'off',\n      auto: 'auto',\n      torch: 'torch',\n    };\n  },\n  get AutoFocus() {\n    return {\n      on: 'on',\n      off: 'off',\n      auto: 'auto',\n      singleShot: 'singleShot',\n    };\n  },\n  get WhiteBalance() {\n    return {\n      auto: 'auto',\n      continuous: 'continuous',\n      manual: 'manual',\n    };\n  },\n  get VideoQuality() {\n    return {};\n  },\n  get VideoStabilization() {\n    return {};\n  },\n  async isAvailableAsync(): Promise<boolean> {\n    return canGetUserMedia();\n  },\n  async takePicture(\n    options: CameraPictureOptions,\n    camera: ExponentCameraRef\n  ): Promise<CameraCapturedPicture> {\n    return await camera.takePicture(options);\n  },\n  async pausePreview(camera: ExponentCameraRef): Promise<void> {\n    await camera.pausePreview();\n  },\n  async resumePreview(camera: ExponentCameraRef): Promise<void> {\n    return await camera.resumePreview();\n  },\n  async getAvailableCameraTypesAsync(): Promise<string[]> {\n    if (!canGetUserMedia() || !navigator.mediaDevices.enumerateDevices) return [];\n\n    const devices = await navigator.mediaDevices.enumerateDevices();\n\n    const types: (string | null)[] = await Promise.all([\n      (await isFrontCameraAvailableAsync(devices)) && CameraType.front,\n      (await isBackCameraAvailableAsync()) && CameraType.back,\n    ]);\n\n    return types.filter(Boolean) as string[];\n  },\n  async getAvailablePictureSizes(ratio: string, camera: ExponentCameraRef): Promise<string[]> {\n    return await camera.getAvailablePictureSizes(ratio);\n  },\n  /* async getSupportedRatios(camera: ExponentCameraRef): Promise<string[]> {\n    // TODO: Support on web\n  },\n  async record(\n    options?: CameraRecordingOptions,\n    camera: ExponentCameraRef\n  ): Promise<{ uri: string }> {\n    // TODO: Support on web\n  },\n  async stopRecording(camera: ExponentCameraRef): Promise<void> {\n    // TODO: Support on web\n  }, */\n  async getPermissionsAsync(): Promise<PermissionResponse> {\n    if (!navigator?.permissions?.query) {\n      throw new UnavailabilityError('expo-camera', 'navigator.permissions API is not available');\n    }\n\n    const { state } = await navigator.permissions.query({ name: 'camera' });\n    switch (state) {\n      case 'prompt':\n        return {\n          status: PermissionStatus.UNDETERMINED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: false,\n        };\n      case 'granted':\n        return {\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true,\n        };\n      case 'denied':\n        return {\n          status: PermissionStatus.DENIED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: false,\n        };\n    }\n  },\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    try {\n      await getUserMedia({\n        video: true,\n      });\n      return {\n        status: PermissionStatus.GRANTED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: true,\n      };\n    } catch ({ message }) {\n      // name: NotAllowedError\n      // code: 0\n      if (message === 'Permission dismissed') {\n        return {\n          status: PermissionStatus.UNDETERMINED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: false,\n        };\n      } else {\n        // TODO: Bacon: [OSX] The system could deny access to chrome.\n        // TODO: Bacon: add: { status: 'unimplemented' }\n        return {\n          status: PermissionStatus.DENIED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: false,\n        };\n      }\n    }\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}