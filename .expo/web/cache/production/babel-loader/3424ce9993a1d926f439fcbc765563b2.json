{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import invariant from'invariant';import{CameraType,ImageType}from\"./Camera.types\";import*as CapabilityUtils from\"./WebCapabilityUtils\";import{CameraTypeToFacingMode,ImageTypeFormat,MinimumConstraints}from\"./WebConstants\";import{requestUserMediaAsync}from\"./WebUserMediaManager\";export function getImageSize(videoWidth,videoHeight,scale){var width=videoWidth*scale;var ratio=videoWidth/width;var height=videoHeight/ratio;return{width:width,height:height};}export function toDataURL(canvas,imageType,quality){invariant(Object.values(ImageType).includes(imageType),\"expo-camera: \"+imageType+\" is not a valid ImageType. Expected a string from: \"+Object.values(ImageType).join(', '));var format=ImageTypeFormat[imageType];if(imageType===ImageType.jpg){invariant(quality<=1&&quality>=0,\"expo-camera: \"+quality+\" is not a valid image quality. Expected a number from 0...1\");return canvas.toDataURL(format,quality);}else{return canvas.toDataURL(format);}}export function hasValidConstraints(preferredCameraType,width,height){return preferredCameraType!==undefined&&width!==undefined&&height!==undefined;}function ensureCameraPictureOptions(config){var captureOptions={scale:1,imageType:ImageType.png,isImageMirror:false};for(var key in config){if(key in config&&config[key]!==undefined&&key in captureOptions){captureOptions[key]=config[key];}}return captureOptions;}var DEFAULT_QUALITY=0.92;export function captureImageData(video){var pictureOptions=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!video||video.readyState!==video.HAVE_ENOUGH_DATA){return null;}var canvas=captureImageContext(video,pictureOptions);var context=canvas.getContext('2d',{alpha:false});if(!context||!canvas.width||!canvas.height){return null;}var imageData=context.getImageData(0,0,canvas.width,canvas.height);return imageData;}export function captureImageContext(video,_ref){var _ref$scale=_ref.scale,scale=_ref$scale===void 0?1:_ref$scale,_ref$isImageMirror=_ref.isImageMirror,isImageMirror=_ref$isImageMirror===void 0?false:_ref$isImageMirror;var videoWidth=video.videoWidth,videoHeight=video.videoHeight;var _getImageSize=getImageSize(videoWidth,videoHeight,scale),width=_getImageSize.width,height=_getImageSize.height;var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;var context=canvas.getContext('2d',{alpha:false});if(!context){throw new Error('Context is not defined');}if(isImageMirror){context.setTransform(-1,0,0,1,canvas.width,0);}context.drawImage(video,0,0,width,height);return canvas;}export function captureImage(video,pictureOptions){var config=ensureCameraPictureOptions(pictureOptions);var canvas=captureImageContext(video,config);var imageType=config.imageType,_config$quality=config.quality,quality=_config$quality===void 0?DEFAULT_QUALITY:_config$quality;return toDataURL(canvas,imageType,quality);}function getSupportedConstraints(){if(navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints){return navigator.mediaDevices.getSupportedConstraints();}return null;}export function getIdealConstraints(preferredCameraType,width,height){var preferredConstraints={audio:false,video:{}};if(hasValidConstraints(preferredCameraType,width,height)){return MinimumConstraints;}var supports=getSupportedConstraints();if(!supports||!supports.facingMode||!supports.width||!supports.height){return MinimumConstraints;}if(preferredCameraType&&Object.values(CameraType).includes(preferredCameraType)){var facingMode=CameraTypeToFacingMode[preferredCameraType];if(isWebKit()){var key=facingMode==='user'?'exact':'ideal';preferredConstraints.video.facingMode=_defineProperty({},key,facingMode);}else{preferredConstraints.video.facingMode={ideal:CameraTypeToFacingMode[preferredCameraType]};}}if(isMediaTrackConstraints(preferredConstraints.video)){preferredConstraints.video.width=width;preferredConstraints.video.height=height;}return preferredConstraints;}function isMediaTrackConstraints(input){return input&&typeof input.video!=='boolean';}export function getPreferredStreamDevice(preferredCameraType,preferredWidth,preferredHeight){var nextCameraType;return _regeneratorRuntime.async(function getPreferredStreamDevice$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(getStreamDevice(preferredCameraType,preferredWidth,preferredHeight));case 3:return _context.abrupt(\"return\",_context.sent);case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);if(!(_context.t0 instanceof OverconstrainedError&&_context.t0.constraint==='facingMode')){_context.next=13;break;}nextCameraType=preferredCameraType===CameraType.back?CameraType.front:CameraType.back;_context.next=12;return _regeneratorRuntime.awrap(getStreamDevice(nextCameraType,preferredWidth,preferredHeight));case 12:return _context.abrupt(\"return\",_context.sent);case 13:throw _context.t0;case 14:case\"end\":return _context.stop();}}},null,null,[[0,6]],Promise);}export function getStreamDevice(preferredCameraType,preferredWidth,preferredHeight){var constraints,stream;return _regeneratorRuntime.async(function getStreamDevice$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:constraints=getIdealConstraints(preferredCameraType,preferredWidth,preferredHeight);_context2.next=3;return _regeneratorRuntime.awrap(requestUserMediaAsync(constraints));case 3:stream=_context2.sent;return _context2.abrupt(\"return\",stream);case 5:case\"end\":return _context2.stop();}}},null,null,null,Promise);}export function isWebKit(){return /WebKit/.test(navigator.userAgent)&&!/Edg/.test(navigator.userAgent);}export function compareStreams(a,b){if(!a||!b){return false;}var settingsA=a.getTracks()[0].getSettings();var settingsB=b.getTracks()[0].getSettings();return settingsA.deviceId===settingsB.deviceId;}export function capture(video,settings,config){var base64=captureImage(video,config);var capturedPicture={uri:base64,base64:base64,width:0,height:0};if(settings){var _settings$width=settings.width,width=_settings$width===void 0?0:_settings$width,_settings$height=settings.height,height=_settings$height===void 0?0:_settings$height;capturedPicture.width=width;capturedPicture.height=height;capturedPicture.exif=settings;}if(config.onPictureSaved){config.onPictureSaved(capturedPicture);}return capturedPicture;}export function syncTrackCapabilities(cameraType,stream){var settings,_args3=arguments;return _regeneratorRuntime.async(function syncTrackCapabilities$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:settings=_args3.length>2&&_args3[2]!==undefined?_args3[2]:{};if(!(stream!=null&&stream.getVideoTracks)){_context3.next=4;break;}_context3.next=4;return _regeneratorRuntime.awrap(Promise.all(stream.getVideoTracks().map(function(track){return onCapabilitiesReady(cameraType,track,settings);})));case 4:case\"end\":return _context3.stop();}}},null,null,null,Promise);}function onCapabilitiesReady(cameraType,track){var settings,capabilities,constraints,clampedValues,_i,_clampedValues,property,validatedInternalConstrainedValue,_args4=arguments;return _regeneratorRuntime.async(function onCapabilitiesReady$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:validatedInternalConstrainedValue=function _validatedInternalCon(constraintKey,settingsKey,converter){var convertedSetting=converter(settings[settingsKey]);return validatedConstrainedValue({constraintKey:constraintKey,settingsKey:settingsKey,convertedSetting:convertedSetting,capabilities:capabilities,settings:settings,cameraType:cameraType});};settings=_args4.length>2&&_args4[2]!==undefined?_args4[2]:{};capabilities=track.getCapabilities();constraints={};clampedValues=['exposureCompensation','colorTemperature','iso','brightness','contrast','saturation','sharpness','focusDistance','zoom'];for(_i=0,_clampedValues=clampedValues;_i<_clampedValues.length;_i++){property=_clampedValues[_i];if(capabilities[property]){constraints[property]=convertNormalizedSetting(capabilities[property],settings[property]);}}if(capabilities.focusMode&&settings.autoFocus!==undefined){constraints.focusMode=validatedInternalConstrainedValue('focusMode','autoFocus',CapabilityUtils.convertAutoFocusJSONToNative);}if(capabilities.torch&&settings.flashMode!==undefined){constraints.torch=validatedInternalConstrainedValue('torch','flashMode',CapabilityUtils.convertFlashModeJSONToNative);}if(capabilities.whiteBalanceMode&&settings.whiteBalance!==undefined){constraints.whiteBalanceMode=validatedInternalConstrainedValue('whiteBalanceMode','whiteBalance',CapabilityUtils.convertWhiteBalanceJSONToNative);}_context4.prev=9;_context4.next=12;return _regeneratorRuntime.awrap(track.applyConstraints({advanced:[constraints]}));case 12:_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](9);if(__DEV__)console.warn('Failed to apply constraints',_context4.t0);case 17:case\"end\":return _context4.stop();}}},null,null,[[9,14]],Promise);}export function stopMediaStream(stream){if(!stream){return;}if(stream.getAudioTracks){stream.getAudioTracks().forEach(function(track){return track.stop();});}if(stream.getVideoTracks){stream.getVideoTracks().forEach(function(track){return track.stop();});}if(isMediaStreamTrack(stream)){stream.stop();}}export function setVideoSource(video,stream){var _window$URL$createObj;var createObjectURL=(_window$URL$createObj=window.URL.createObjectURL)!=null?_window$URL$createObj:window.webkitURL.createObjectURL;if(typeof video.srcObject!=='undefined'){video.srcObject=stream;}else if(typeof video.mozSrcObject!=='undefined'){video.mozSrcObject=stream;}else if(stream&&createObjectURL){video.src=createObjectURL(stream);}if(!stream){var _window$URL$revokeObj,_ref2,_video$src;var revokeObjectURL=(_window$URL$revokeObj=window.URL.revokeObjectURL)!=null?_window$URL$revokeObj:window.webkitURL.revokeObjectURL;var source=(_ref2=(_video$src=video.src)!=null?_video$src:video.srcObject)!=null?_ref2:video.mozSrcObject;if(revokeObjectURL&&typeof source==='string'){revokeObjectURL(source);}}}export function isCapabilityAvailable(video,keyName){var stream=video.srcObject;if(stream instanceof MediaStream){var _videoTrack$getCapabi;var videoTrack=stream.getVideoTracks()[0];return videoTrack.getCapabilities==null?void 0:(_videoTrack$getCapabi=videoTrack.getCapabilities())==null?void 0:_videoTrack$getCapabi[keyName];}return false;}function isMediaStreamTrack(input){return typeof input.stop==='function';}function convertNormalizedSetting(range,value){if(!value){return;}var converted=convertRange(value,[range.min,range.max]);return Math.min(range.max,Math.max(range.min,converted));}function convertRange(value,r2){var r1=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[0,1];return(value-r1[0])*(r2[1]-r2[0])/(r1[1]-r1[0])+r2[0];}function validatedConstrainedValue(props){var constraintKey=props.constraintKey,settingsKey=props.settingsKey,convertedSetting=props.convertedSetting,capabilities=props.capabilities,settings=props.settings,cameraType=props.cameraType;var setting=settings[settingsKey];if(Array.isArray(capabilities[constraintKey])&&convertedSetting&&!capabilities[constraintKey].includes(convertedSetting)){if(__DEV__){console.warn(\" { \"+settingsKey+\": \\\"\"+setting+\"\\\" } (converted to \\\"\"+convertedSetting+\"\\\" in the browser) is not supported for camera type \\\"\"+cameraType+\"\\\" in your browser. Using the default value instead.\");}return undefined;}return convertedSetting;}","map":{"version":3,"sources":["../src/WebCameraUtils.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-env browser */\nimport invariant from 'invariant';\n\nimport {\n  CameraType,\n  CapturedPicture,\n  ImageSize,\n  ImageType,\n  WebCameraSettings,\n  CameraPictureOptions,\n} from './Camera.types';\nimport * as CapabilityUtils from './WebCapabilityUtils';\nimport { CameraTypeToFacingMode, ImageTypeFormat, MinimumConstraints } from './WebConstants';\nimport { requestUserMediaAsync } from './WebUserMediaManager';\n\ninterface ConstrainLongRange {\n  max?: number;\n  min?: number;\n  exact?: number;\n  ideal?: number;\n}\n\nexport function getImageSize(videoWidth: number, videoHeight: number, scale: number): ImageSize {\n  const width = videoWidth * scale;\n  const ratio = videoWidth / width;\n  const height = videoHeight / ratio;\n\n  return {\n    width,\n    height,\n  };\n}\n\nexport function toDataURL(\n  canvas: HTMLCanvasElement,\n  imageType: ImageType,\n  quality: number\n): string {\n  invariant(\n    Object.values(ImageType).includes(imageType),\n    `expo-camera: ${imageType} is not a valid ImageType. Expected a string from: ${Object.values(\n      ImageType\n    ).join(', ')}`\n  );\n\n  const format = ImageTypeFormat[imageType];\n  if (imageType === ImageType.jpg) {\n    invariant(\n      quality <= 1 && quality >= 0,\n      `expo-camera: ${quality} is not a valid image quality. Expected a number from 0...1`\n    );\n    return canvas.toDataURL(format, quality);\n  } else {\n    return canvas.toDataURL(format);\n  }\n}\n\nexport function hasValidConstraints(\n  preferredCameraType?: CameraType,\n  width?: number | ConstrainLongRange,\n  height?: number | ConstrainLongRange\n): boolean {\n  return preferredCameraType !== undefined && width !== undefined && height !== undefined;\n}\n\nfunction ensureCameraPictureOptions(config: CameraPictureOptions): CameraPictureOptions {\n  const captureOptions = {\n    scale: 1,\n    imageType: ImageType.png,\n    isImageMirror: false,\n  };\n\n  for (const key in config) {\n    if (key in config && config[key] !== undefined && key in captureOptions) {\n      captureOptions[key] = config[key];\n    }\n  }\n  return captureOptions;\n}\n\nconst DEFAULT_QUALITY = 0.92;\n\nexport function captureImageData(\n  video: HTMLVideoElement | null,\n  pictureOptions: Pick<CameraPictureOptions, 'scale' | 'isImageMirror'> = {}\n): ImageData | null {\n  if (!video || video.readyState !== video.HAVE_ENOUGH_DATA) {\n    return null;\n  }\n  const canvas = captureImageContext(video, pictureOptions);\n\n  const context = canvas.getContext('2d', { alpha: false });\n  if (!context || !canvas.width || !canvas.height) {\n    return null;\n  }\n\n  const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n  return imageData;\n}\n\nexport function captureImageContext(\n  video: HTMLVideoElement,\n  { scale = 1, isImageMirror = false }: Pick<CameraPictureOptions, 'scale' | 'isImageMirror'>\n): HTMLCanvasElement {\n  const { videoWidth, videoHeight } = video;\n  const { width, height } = getImageSize(videoWidth, videoHeight, scale!);\n\n  // Build the canvas size and draw the camera image to the context from video\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const context = canvas.getContext('2d', { alpha: false });\n\n  if (!context) {\n    // Should never be called\n    throw new Error('Context is not defined');\n  }\n  // sharp image details\n  // context.imageSmoothingEnabled = false;\n\n  // Flip horizontally (as css transform: rotateY(180deg))\n  if (isImageMirror) {\n    context.setTransform(-1, 0, 0, 1, canvas.width, 0);\n  }\n\n  context.drawImage(video, 0, 0, width, height);\n\n  return canvas;\n}\n\nexport function captureImage(\n  video: HTMLVideoElement,\n  pictureOptions: CameraPictureOptions\n): string {\n  const config = ensureCameraPictureOptions(pictureOptions);\n  const canvas = captureImageContext(video, config);\n  const { imageType, quality = DEFAULT_QUALITY } = config;\n  return toDataURL(canvas, imageType!, quality);\n}\n\nfunction getSupportedConstraints(): MediaTrackSupportedConstraints | null {\n  if (navigator.mediaDevices && navigator.mediaDevices.getSupportedConstraints) {\n    return navigator.mediaDevices.getSupportedConstraints();\n  }\n  return null;\n}\n\nexport function getIdealConstraints(\n  preferredCameraType: CameraType,\n  width?: number | ConstrainLongRange,\n  height?: number | ConstrainLongRange\n): MediaStreamConstraints {\n  const preferredConstraints: MediaStreamConstraints = {\n    audio: false,\n    video: {},\n  };\n\n  if (hasValidConstraints(preferredCameraType, width, height)) {\n    return MinimumConstraints;\n  }\n\n  const supports = getSupportedConstraints();\n  // TODO(Bacon): Test this\n  if (!supports || !supports.facingMode || !supports.width || !supports.height) {\n    return MinimumConstraints;\n  }\n\n  if (preferredCameraType && Object.values(CameraType).includes(preferredCameraType)) {\n    const facingMode = CameraTypeToFacingMode[preferredCameraType];\n    if (isWebKit()) {\n      const key = facingMode === 'user' ? 'exact' : 'ideal';\n      (preferredConstraints.video as MediaTrackConstraints).facingMode = {\n        [key]: facingMode,\n      };\n    } else {\n      (preferredConstraints.video as MediaTrackConstraints).facingMode = {\n        ideal: CameraTypeToFacingMode[preferredCameraType],\n      };\n    }\n  }\n\n  if (isMediaTrackConstraints(preferredConstraints.video)) {\n    preferredConstraints.video.width = width;\n    preferredConstraints.video.height = height;\n  }\n\n  return preferredConstraints;\n}\n\nfunction isMediaTrackConstraints(input: any): input is MediaTrackConstraints {\n  return input && typeof input.video !== 'boolean';\n}\n\n/**\n * Invoke getStreamDevice a second time with the opposing camera type if the preferred type cannot be retrieved.\n *\n * @param preferredCameraType\n * @param preferredWidth\n * @param preferredHeight\n */\nexport async function getPreferredStreamDevice(\n  preferredCameraType: CameraType,\n  preferredWidth?: number | ConstrainLongRange,\n  preferredHeight?: number | ConstrainLongRange\n): Promise<MediaStream> {\n  try {\n    return await getStreamDevice(preferredCameraType, preferredWidth, preferredHeight);\n  } catch (error) {\n    // A hack on desktop browsers to ensure any camera is used.\n    // eslint-disable-next-line no-undef\n    if (error instanceof OverconstrainedError && error.constraint === 'facingMode') {\n      const nextCameraType =\n        preferredCameraType === CameraType.back ? CameraType.front : CameraType.back;\n      return await getStreamDevice(nextCameraType, preferredWidth, preferredHeight);\n    }\n    throw error;\n  }\n}\n\nexport async function getStreamDevice(\n  preferredCameraType: CameraType,\n  preferredWidth?: number | ConstrainLongRange,\n  preferredHeight?: number | ConstrainLongRange\n): Promise<MediaStream> {\n  const constraints: MediaStreamConstraints = getIdealConstraints(\n    preferredCameraType,\n    preferredWidth,\n    preferredHeight\n  );\n  const stream: MediaStream = await requestUserMediaAsync(constraints);\n  return stream;\n}\n\nexport function isWebKit(): boolean {\n  return /WebKit/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent);\n}\n\nexport function compareStreams(a: MediaStream | null, b: MediaStream | null): boolean {\n  if (!a || !b) {\n    return false;\n  }\n  const settingsA = a.getTracks()[0].getSettings();\n  const settingsB = b.getTracks()[0].getSettings();\n  return settingsA.deviceId === settingsB.deviceId;\n}\n\nexport function capture(\n  video: HTMLVideoElement,\n  settings: MediaTrackSettings,\n  config: CameraPictureOptions\n): CapturedPicture {\n  const base64 = captureImage(video, config);\n\n  const capturedPicture: CapturedPicture = {\n    uri: base64,\n    base64,\n    width: 0,\n    height: 0,\n  };\n\n  if (settings) {\n    const { width = 0, height = 0 } = settings;\n    capturedPicture.width = width;\n    capturedPicture.height = height;\n    capturedPicture.exif = settings;\n  }\n\n  if (config.onPictureSaved) {\n    config.onPictureSaved(capturedPicture);\n  }\n  return capturedPicture;\n}\n\nexport async function syncTrackCapabilities(\n  cameraType: CameraType,\n  stream: MediaStream | null,\n  settings: WebCameraSettings = {}\n): Promise<void> {\n  if (stream?.getVideoTracks) {\n    await Promise.all(\n      stream.getVideoTracks().map(track => onCapabilitiesReady(cameraType, track, settings))\n    );\n  }\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints\nasync function onCapabilitiesReady(\n  cameraType: CameraType,\n  track: MediaStreamTrack,\n  settings: WebCameraSettings = {}\n): Promise<void> {\n  const capabilities = track.getCapabilities();\n\n  // Create an empty object because if you set a constraint that isn't available an error will be thrown.\n  const constraints: MediaTrackConstraintSet = {};\n\n  // TODO(Bacon): Add `pointsOfInterest` support\n  const clampedValues = [\n    'exposureCompensation',\n    'colorTemperature',\n    'iso',\n    'brightness',\n    'contrast',\n    'saturation',\n    'sharpness',\n    'focusDistance',\n    'zoom',\n  ];\n\n  for (const property of clampedValues) {\n    if (capabilities[property]) {\n      constraints[property] = convertNormalizedSetting(capabilities[property], settings[property]);\n    }\n  }\n\n  function validatedInternalConstrainedValue<IConvertedType>(\n    constraintKey: string,\n    settingsKey: string,\n    converter: (settingValue: any) => IConvertedType\n  ) {\n    const convertedSetting = converter(settings[settingsKey]);\n    return validatedConstrainedValue({\n      constraintKey,\n      settingsKey,\n      convertedSetting,\n      capabilities,\n      settings,\n      cameraType,\n    });\n  }\n\n  if (capabilities.focusMode && settings.autoFocus !== undefined) {\n    constraints.focusMode = validatedInternalConstrainedValue<MediaTrackConstraintSet['focusMode']>(\n      'focusMode',\n      'autoFocus',\n      CapabilityUtils.convertAutoFocusJSONToNative\n    );\n  }\n\n  if (capabilities.torch && settings.flashMode !== undefined) {\n    constraints.torch = validatedInternalConstrainedValue<MediaTrackConstraintSet['torch']>(\n      'torch',\n      'flashMode',\n      CapabilityUtils.convertFlashModeJSONToNative\n    );\n  }\n\n  if (capabilities.whiteBalanceMode && settings.whiteBalance !== undefined) {\n    constraints.whiteBalanceMode = validatedInternalConstrainedValue<\n      MediaTrackConstraintSet['whiteBalanceMode']\n    >('whiteBalanceMode', 'whiteBalance', CapabilityUtils.convertWhiteBalanceJSONToNative);\n  }\n\n  try {\n    await track.applyConstraints({ advanced: [constraints] });\n  } catch (error) {\n    if (__DEV__) console.warn('Failed to apply constraints', error);\n  }\n}\n\nexport function stopMediaStream(stream: MediaStream | null) {\n  if (!stream) {\n    return;\n  }\n  if (stream.getAudioTracks) {\n    stream.getAudioTracks().forEach(track => track.stop());\n  }\n  if (stream.getVideoTracks) {\n    stream.getVideoTracks().forEach(track => track.stop());\n  }\n  if (isMediaStreamTrack(stream)) {\n    stream.stop();\n  }\n}\n\nexport function setVideoSource(\n  video: HTMLVideoElement,\n  stream: MediaStream | MediaSource | Blob | null\n): void {\n  const createObjectURL = window.URL.createObjectURL ?? window.webkitURL.createObjectURL;\n\n  if (typeof video.srcObject !== 'undefined') {\n    video.srcObject = stream;\n  } else if (typeof (video as any).mozSrcObject !== 'undefined') {\n    (video as any).mozSrcObject = stream;\n  } else if (stream && createObjectURL) {\n    video.src = createObjectURL(stream);\n  }\n\n  if (!stream) {\n    const revokeObjectURL = window.URL.revokeObjectURL ?? window.webkitURL.revokeObjectURL;\n    const source = video.src ?? video.srcObject ?? (video as any).mozSrcObject;\n    if (revokeObjectURL && typeof source === 'string') {\n      revokeObjectURL(source);\n    }\n  }\n}\n\nexport function isCapabilityAvailable(video: HTMLVideoElement, keyName: string): boolean {\n  const stream = video.srcObject;\n\n  if (stream instanceof MediaStream) {\n    const videoTrack = stream.getVideoTracks()[0];\n    return videoTrack.getCapabilities?.()?.[keyName];\n  }\n\n  return false;\n}\n\nfunction isMediaStreamTrack(input: any): input is MediaStreamTrack {\n  return typeof input.stop === 'function';\n}\n\nfunction convertNormalizedSetting(range: MediaSettingsRange, value?: number): number | undefined {\n  if (!value) {\n    return;\n  }\n  // convert the normalized incoming setting to the native camera zoom range\n  const converted = convertRange(value, [range.min, range.max]);\n  // clamp value so we don't get an error\n  return Math.min(range.max, Math.max(range.min, converted));\n}\n\nfunction convertRange(value: number, r2: number[], r1: number[] = [0, 1]): number {\n  return ((value - r1[0]) * (r2[1] - r2[0])) / (r1[1] - r1[0]) + r2[0];\n}\n\nfunction validatedConstrainedValue<T>(props: {\n  constraintKey: string;\n  settingsKey: string;\n  convertedSetting: T;\n  capabilities: MediaTrackCapabilities;\n  settings: WebCameraSettings;\n  cameraType: string;\n}): T | undefined {\n  const {\n    constraintKey,\n    settingsKey,\n    convertedSetting,\n    capabilities,\n    settings,\n    cameraType,\n  } = props;\n  const setting = settings[settingsKey];\n  if (\n    Array.isArray(capabilities[constraintKey]) &&\n    convertedSetting &&\n    !capabilities[constraintKey].includes(convertedSetting)\n  ) {\n    if (__DEV__) {\n      // Only warn in dev mode.\n      console.warn(\n        ` { ${settingsKey}: \"${setting}\" } (converted to \"${convertedSetting}\" in the browser) is not supported for camera type \"${cameraType}\" in your browser. Using the default value instead.`\n      );\n    }\n    return undefined;\n  }\n  return convertedSetting;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}